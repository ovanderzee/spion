{"version":3,"file":"createSpion.js","sources":["../src/functions.ts","../src/index.ts"],"sourcesContent":["export const clone = function (original: Function, context?: any): Function {\n    // Creates a new function, optionally preserving desired context.\n    const bound = original.bind(context)\n    // Shallow copies over function properties, if any.\n    const replica = Object.assign(bound, original)\n    return replica\n}\n\nexport const randomString = (): string => {\n    const integer = Math.round(Math.random() * 10e9)\n    return integer.toString(36)\n}\n\nexport const sleep = (duration: number): Promise<void> => {\n    return new Promise((resolve) => {\n        setTimeout(resolve, duration)\n    })\n}\n","import { Intelligence, Spion } from './types.js'\nimport { clone, randomString } from './functions.js'\n\nconst createSpion = function (\n    api: any,\n    functionName: string,\n    context?: any,\n): Spion {\n    const original: Function = api[functionName]\n    const replica = clone(original, context)\n    const callData: Intelligence[] = []\n    const processId = randomString()\n\n    const interceptor = function () {\n        const currentIntelligence: Intelligence = {\n            id: processId,\n            args: Array.from(arguments),\n            return: replica(...arguments),\n        }\n        callData.push(currentIntelligence)\n        return currentIntelligence.return\n    }\n\n    api[functionName] = interceptor\n\n    const debrief = function (): Intelligence[] {\n        destroy()\n        return report()\n    }\n\n    const destroy = function (): void {\n        api[functionName] = original\n    }\n\n    const report = function (): Intelligence[] {\n        const filteredCallData = callData.filter((cd) => cd.id === processId)\n        const mappedCallData = filteredCallData.map((cd) => {\n            delete cd.id\n            return cd\n        })\n        return mappedCallData\n    }\n\n    return {\n        debrief: debrief,\n        destroy: destroy,\n        report: report,\n    }\n}\n\nexport default createSpion\n"],"names":[],"mappings":"AAAa,MAAA,KAAA,GAAQ,SAAU,QAAA,EAAoB,OAAyB,EAAA;AAExE,EAAM,MAAA,KAAA,GAAQ,QAAS,CAAA,IAAA,CAAK,OAAO,CAAA,CAAA;AAEnC,EAAA,MAAM,OAAU,GAAA,MAAA,CAAO,MAAO,CAAA,KAAA,EAAO,QAAQ,CAAA,CAAA;AAC7C,EAAO,OAAA,OAAA,CAAA;AACX,CAAA,CAAA;AAEO,MAAM,eAAe,MAAc;AACtC,EAAA,MAAM,UAAU,IAAK,CAAA,KAAA,CAAM,IAAK,CAAA,MAAA,KAAW,IAAI,CAAA,CAAA;AAC/C,EAAO,OAAA,OAAA,CAAQ,SAAS,EAAE,CAAA,CAAA;AAC9B,CAAA;;ACRA,MAAM,WAAc,GAAA,SAChB,GACA,EAAA,YAAA,EACA,OACK,EAAA;AACL,EAAM,MAAA,QAAA,GAAqB,IAAI,YAAY,CAAA,CAAA;AAC3C,EAAM,MAAA,OAAA,GAAU,KAAM,CAAA,QAAA,EAAU,OAAO,CAAA,CAAA;AACvC,EAAA,MAAM,WAA2B,EAAC,CAAA;AAClC,EAAA,MAAM,YAAY,YAAa,EAAA,CAAA;AAE/B,EAAA,MAAM,cAAc,WAAY;AAC5B,IAAA,MAAM,mBAAoC,GAAA;AAAA,MACtC,EAAI,EAAA,SAAA;AAAA,MACJ,IAAA,EAAM,KAAM,CAAA,IAAA,CAAK,SAAS,CAAA;AAAA,MAC1B,MAAA,EAAQ,OAAQ,CAAA,GAAG,SAAS,CAAA;AAAA,KAChC,CAAA;AACA,IAAA,QAAA,CAAS,KAAK,mBAAmB,CAAA,CAAA;AACjC,IAAA,OAAO,mBAAoB,CAAA,MAAA,CAAA;AAAA,GAC/B,CAAA;AAEA,EAAA,GAAA,CAAI,YAAY,CAAI,GAAA,WAAA,CAAA;AAEpB,EAAA,MAAM,UAAU,WAA4B;AACxC,IAAQ,OAAA,EAAA,CAAA;AACR,IAAA,OAAO,MAAO,EAAA,CAAA;AAAA,GAClB,CAAA;AAEA,EAAA,MAAM,UAAU,WAAkB;AAC9B,IAAA,GAAA,CAAI,YAAY,CAAI,GAAA,QAAA,CAAA;AAAA,GACxB,CAAA;AAEA,EAAA,MAAM,SAAS,WAA4B;AACvC,IAAA,MAAM,mBAAmB,QAAS,CAAA,MAAA,CAAO,CAAC,EAAO,KAAA,EAAA,CAAG,OAAO,SAAS,CAAA,CAAA;AACpE,IAAA,MAAM,cAAiB,GAAA,gBAAA,CAAiB,GAAI,CAAA,CAAC,EAAO,KAAA;AAChD,MAAA,OAAO,EAAG,CAAA,EAAA,CAAA;AACV,MAAO,OAAA,EAAA,CAAA;AAAA,KACV,CAAA,CAAA;AACD,IAAO,OAAA,cAAA,CAAA;AAAA,GACX,CAAA;AAEA,EAAO,OAAA;AAAA,IACH,OAAA;AAAA,IACA,OAAA;AAAA,IACA,MAAA;AAAA,GACJ,CAAA;AACJ;;;;"}